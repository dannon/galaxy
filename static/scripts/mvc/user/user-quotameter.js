define(["mvc/base-mvc","utils/localization","mvc/history/history-model"],function(a,b,c){"use strict";var d="user",e=Backbone.View.extend(a.LoggableMixin).extend({_logNamespace:d,options:{warnAtPercent:85,errorAtPercent:100},initialize:function(a){this.log(this+".initialize:",a),_.extend(this.options,a),this.listenTo(this.model,"change:quota_percent change:total_disk_usage",this.render)},update:function(a){return this.log(this+" updating user data...",a),this.model.loadFromApi(this.model.get("id"),a),this},isOverQuota:function(){return null!==this.model.get("quota_percent")&&this.model.get("quota_percent")>=this.options.errorAtPercent},_render_quota:function(){var a=this.model.toJSON(),b=a.quota_percent,c=$(this._templateQuotaMeter(a)),d=c.find(".progress-bar");return this.isOverQuota()?(d.attr("class","progress-bar progress-bar-danger"),c.find(".quota-meter-text").css("color","white"),this.trigger("quota:over",a)):b>=this.options.warnAtPercent?(d.attr("class","progress-bar progress-bar-warning"),this.trigger("quota:under quota:under:approaching",a)):(d.attr("class","progress-bar progress-bar-success"),this.trigger("quota:under quota:under:ok",a)),c},_render_usage:function(){var a=$(this._templateUsage(this.model.toJSON()));return this.log(this+".rendering usage:",a),a},render:function(){var a=null;return this.log(this+".model.quota_percent:",this.model.get("quota_percent")),a=null===this.model.get("quota_percent")||void 0===this.model.get("quota_percent")?this._render_usage():this._render_quota(),this.$el.html(a),this.$el.find(".quota-meter-text").tooltip(),this},_templateQuotaMeter:function(a){return['<div id="quota-meter" class="quota-meter progress">','<div class="progress-bar" style="width: ',a.quota_percent,'%"></div>','<div class="quota-meter-text" style="top: 6px"',a.nice_total_disk_usage?' title="Using '+a.nice_total_disk_usage+'">':">",b("Using")," ",a.quota_percent,"%","</div>","</div>"].join("")},_templateUsage:function(a){return['<div id="quota-meter" class="quota-meter" style="background-color: transparent">','<div class="quota-meter-text" style="top: 6px; color: white">',a.nice_total_disk_usage?b("Using ")+a.nice_total_disk_usage:"","</div>","</div>"].join("")},toString:function(){return"UserQuotaMeter("+this.model+")"}}),f=Backbone.View.extend({initialize:function(){var a=this;this.setElement("<div/>"),this.model=new c.HistoryCollection(null,{includeDeleted:!0}),this.model.fetch({success:function(){a.render()},error:function(){console.error("Failed to fetch usage information.")}})},render:function(){require("libs/Chart.js");var a=_.template(["<h2>Galaxy Quota Usage</h2>","<% _.each(histories, function(history) { %>","<li>","<%- history %>","</li>","<% }); %>"].join(""));this.$el.html(a({histories:this.model.models}));var b=$("<canvas/>");$(this.$el).append(b);var c=[],d=360/this.model.models.length,e=0;_.each(this.model.models,function(a){e+=d;var b={name:a.attributes.name,size:a.attributes.size,color:Color("hsl("+e+",60%,50%)").hexString()};c.push(b)}),new Chart(b,{type:"pie",data:{labels:_.pluck(c,"name"),datasets:[{data:_.pluck(c,"size"),backgroundColor:_.pluck(c,"color"),hoverBackgroundColor:_.pluck(c,"color"),label:_.pluck(c,"name")}]},options:{hover:{mode:"single"}}})}});return{UserQuotaMeter:e,UserQuotaGraph:f}});
//# sourceMappingURL=../../../maps/mvc/user/user-quotameter.js.map